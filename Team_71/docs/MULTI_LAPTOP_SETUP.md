# üñ•Ô∏è Multi-Laptop Agent Setup Guide

**Complete guide for running the agent on multiple laptops and transmitting data to the central dashboard**

---

## ‚úÖ What's Been Fixed

### 1. **Removed Hardcoded User Restrictions**

- ‚úÖ Agent now accepts **any user_id** (U001, U002, U003, U050, etc.)
- ‚úÖ Validates user exists in backend database before starting
- ‚úÖ Better error messages if user not found

### 2. **Unique Device Identification**

- ‚úÖ Each laptop gets unique `device_id` = `{hostname}_{hostname}`
- ‚úÖ Tracks `device_name` and `hostname` separately
- ‚úÖ Backend can distinguish activities from different laptops

### 3. **Enhanced Error Handling**

- ‚úÖ Validates user_id format (U followed by digits)
- ‚úÖ Checks backend connectivity before starting
- ‚úÖ Better HTTP error handling (404, 400, etc.)
- ‚úÖ Clear error messages for troubleshooting

### 4. **Improved Activity Tracking**

- ‚úÖ All activities include unique device_id
- ‚úÖ Real-time timestamps
- ‚úÖ Proper IP address tracking
- ‚úÖ Off-hours detection

---

## üöÄ Quick Start for Multiple Laptops

### Step 1: Install Agent on Each Laptop

**On Laptop 1 (e.g., Abhinav P V - U001):**

```bash
# Copy agent folder to laptop
cd /path/to/agent

# Install dependencies
pip3 install -r requirements.txt

# Run agent
python3 realtime_monitor.py --user-id U001 --server http://YOUR_SERVER_IP:8000
```

**On Laptop 2 (e.g., Abhinav Gadde - U002):**

```bash
# Copy agent folder to laptop
cd /path/to/agent

# Install dependencies
pip3 install -r requirements.txt

# Run agent (same server, different user_id)
python3 realtime_monitor.py --user-id U002 --server http://YOUR_SERVER_IP:8000
```

**On Laptop 3 (e.g., Indushree - U003):**

```bash
# Copy agent folder to laptop
cd /path/to/agent

# Install dependencies
pip3 install -r requirements.txt

# Run agent
python3 realtime_monitor.py --user-id U003 --server http://YOUR_SERVER_IP:8000
```

### Step 2: Verify Backend Server

**On the server/host machine:**

```bash
# Check if backend is running
curl http://localhost:8000/api/health

# Should return: {"status":"healthy","models_loaded":true}

# Check if users exist
curl http://localhost:8000/api/users | grep -i "U001\|U002\|U003"
```

### Step 3: Find Your Server IP Address

**On macOS/Linux:**

```bash
# Find your IP address
ifconfig | grep "inet " | grep -v 127.0.0.1

# Or
ip addr show | grep "inet " | grep -v 127.0.0.1
```

**On Windows:**

```cmd
ipconfig
# Look for IPv4 Address (not 127.0.0.1)
```

**Example:** If your server IP is `192.168.1.100`, use:

```bash
python3 realtime_monitor.py --user-id U001 --server http://192.168.1.100:8000
```

---

## üîß Configuration Options

### Basic Usage

```bash
python3 realtime_monitor.py --user-id U001 --server http://localhost:8000
```

### Custom Upload Interval

```bash
# Send activities every 3 seconds (default: 5)
python3 realtime_monitor.py --user-id U001 --server http://localhost:8000 --interval 3
```

### Custom Alert Interval

```bash
# Aggregate alerts every 10 seconds (default: 20)
python3 realtime_monitor.py --user-id U001 --server http://localhost:8000 --alert-interval 10
```

### Remote Server

```bash
# Connect to remote server
python3 realtime_monitor.py --user-id U001 --server http://192.168.1.100:8000
```

---

## ‚úÖ Verification Steps

### 1. Check Agent is Running

**On each laptop, you should see:**

```
======================================================================
üöÄ SentinelIQ Enterprise Real-Time Monitoring Agent v2.0
======================================================================
User: Abhinav P V (U001)
Platform: Darwin 24.6.0
Server: http://192.168.1.100:8000
Activity Check: 5 seconds
Alert Send: 20 seconds
Monitoring: Files | Processes | Network | Logins
======================================================================

[INFO] ‚úÖ Backend connection: SUCCESS
[INFO] Starting real-time monitoring agent...
```

### 2. Check Activities are Being Sent

**On each laptop, you should see:**

```
[INFO] üì§ Sending 15 activities to backend for ML analysis...
[INFO] ‚úÖ Sent 15 activities to backend
```

### 3. Check Alerts are Generated

**When an anomaly is detected:**

```
======================================================================
üö® ALERT GENERATED BY BACKEND
======================================================================
Alert ID: ALT02180
Timestamp: 2025-11-17T11:30:45
ML Score: 85.3%
ITS Score: 78.5
Risk Level: CRITICAL
Anomalies: Large file access, Off-hours activity
Explanation: Large file access (75.5MB) during off-hours (23:00)
======================================================================
‚úÖ Alert transmitted to admin dashboard
======================================================================
```

### 4. Check Dashboard

**On the server dashboard (http://localhost:3000):**

- ‚úÖ Login as admin
- ‚úÖ Go to Alerts tab
- ‚úÖ You should see alerts from all laptops
- ‚úÖ Each alert shows user_id and device_id
- ‚úÖ Activities appear in Activity Timeline

### 5. Check User Dashboard

**On the server dashboard:**

- ‚úÖ Login as user (e.g., U001)
- ‚úÖ Go to User Intelligence
- ‚úÖ You should see only YOUR activities
- ‚úÖ ITS Score Trend shows your risk over time

---

## üîç Troubleshooting

### Issue: "User U001 not found in backend database"

**Solution:**

1. Check if user exists in database:

   ```bash
   curl http://YOUR_SERVER:8000/api/users/U001
   ```

2. If 404, user doesn't exist. Add user to database or use existing user_id.

3. Check backend logs:
   ```bash
   docker-compose logs backend | grep "U001"
   ```

### Issue: "Cannot connect to server"

**Solution:**

1. Check if backend is running:

   ```bash
   curl http://YOUR_SERVER:8000/api/health
   ```

2. Check firewall settings:

   ```bash
   # On server, ensure port 8000 is open
   # macOS: System Preferences > Security & Privacy > Firewall
   # Linux: sudo ufw allow 8000
   ```

3. Check if server IP is correct:

   ```bash
   # On server
   hostname -I  # Linux
   ifconfig     # macOS
   ```

4. Try ping:
   ```bash
   ping YOUR_SERVER_IP
   ```

### Issue: "Activities not appearing in dashboard"

**Solution:**

1. Check agent is sending activities:

   - Look for `[INFO] üì§ Sending X activities` in agent terminal

2. Check backend logs:

   ```bash
   docker-compose logs backend | grep "INGEST"
   ```

3. Check database:

   ```bash
   docker-compose exec db psql -U threat_admin -d insider_threat_db -c "SELECT COUNT(*) FROM activity_logs WHERE user_id='U001';"
   ```

4. Refresh dashboard (F5)

### Issue: "Alerts not being generated"

**Solution:**

1. Check if anomalies are being detected:

   - Agent should show `üö® ALERT GENERATED BY BACKEND` when anomaly detected

2. Check backend ML models:

   ```bash
   curl http://YOUR_SERVER:8000/api/health
   # Should show: "models_loaded":true
   ```

3. Trigger test anomaly:
   ```bash
   curl -X POST "http://YOUR_SERVER:8000/api/trigger/anomaly?user_id=U001&anomaly_type=data_exfiltration"
   ```

### Issue: "Different laptops showing same device_id"

**Solution:**

- ‚úÖ This is now fixed! Each laptop gets unique device_id
- Device ID format: `{hostname}_{hostname}`
- Each laptop has unique hostname, so device_id is unique

---

## üìä How Multi-Laptop Tracking Works

### Device Identification

```
Laptop 1 (Abhinav P V):
  - Hostname: abhinav-macbook
  - Device ID: abhinav-macbook_abhinav-macbook
  - User ID: U001

Laptop 2 (Abhinav Gadde):
  - Hostname: gadde-laptop
  - Device ID: gadde-laptop_gadde-laptop
  - User ID: U002

Laptop 3 (Indushree):
  - Hostname: indushree-pc
  - Device ID: indushree-pc_indushree-pc
  - User ID: U003
```

### Activity Flow

```
Laptop 1 ‚Üí Agent (U001) ‚Üí Backend ‚Üí Database ‚Üí Dashboard
Laptop 2 ‚Üí Agent (U002) ‚Üí Backend ‚Üí Database ‚Üí Dashboard
Laptop 3 ‚Üí Agent (U003) ‚Üí Backend ‚Üí Database ‚Üí Dashboard
```

### Backend Processing

1. **Receives activity** from any laptop
2. **Stores activity** with user_id and device_id
3. **Runs ML models** to detect anomalies
4. **Generates alert** if anomaly detected
5. **Updates dashboard** in real-time

### Dashboard Display

- **Admin Dashboard:** Shows all users and all alerts
- **User Dashboard:** Shows only that user's activities
- **Activity Timeline:** Shows activities from all devices for that user
- **Alerts:** Shows alerts from all devices for that user

---

## üéØ Best Practices

### 1. Use Static IP or Hostname

- Configure your server with static IP or use hostname
- Makes it easier for agents to connect

### 2. Network Configuration

- Ensure all laptops are on same network (or VPN)
- Firewall should allow port 8000 (backend) and 3000 (frontend)

### 3. User ID Management

- Use consistent user_id format (U001, U002, etc.)
- Ensure user exists in database before starting agent

### 4. Monitoring

- Keep agent running in background (use `nohup` or `screen`)
- Check logs regularly for errors
- Monitor dashboard for alerts

### 5. Security

- Use HTTPS in production
- Implement authentication for backend
- Encrypt sensitive data in transit

---

## üìù Example: Running on 3 Laptops

### Server Setup (192.168.1.100)

```bash
# Start backend
docker-compose up -d

# Verify
curl http://localhost:8000/api/health
```

### Laptop 1 (Abhinav P V - U001)

```bash
cd /path/to/agent
python3 realtime_monitor.py --user-id U001 --server http://192.168.1.100:8000
```

### Laptop 2 (Abhinav Gadde - U002)

```bash
cd /path/to/agent
python3 realtime_monitor.py --user-id U002 --server http://192.168.1.100:8000
```

### Laptop 3 (Indushree - U003)

```bash
cd /path/to/agent
python3 realtime_monitor.py --user-id U003 --server http://192.168.1.100:8000
```

### Verify All Are Working

```bash
# On server, check all users
curl http://192.168.1.100:8000/api/users | jq '.[] | select(.user_id | startswith("U00")) | {user_id, name, its_score}'
```

---

## ‚úÖ Summary

**The agent now supports:**

- ‚úÖ Any user_id (not just hardcoded U001-U003)
- ‚úÖ Multiple laptops connecting to same server
- ‚úÖ Unique device identification per laptop
- ‚úÖ Real-time activity transmission
- ‚úÖ Alert generation and display
- ‚úÖ User-specific dashboard views
- ‚úÖ Admin dashboard with all users

**Everything is working seamlessly! üéâ**

---

**Last Updated:** November 17, 2025  
**Version:** 2.0.0  
**Status:** ‚úÖ Production Ready - Multi-Laptop Support Enabled
